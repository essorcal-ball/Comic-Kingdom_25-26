<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bob the Stickman — Community Games</title>
<style>
  :root{
    --orange: #f39c12;
    --army-green: #4b5320;
    --gray: #6b6b6b;
    --brown: #6f4e37;
    --bg: #fbf7f2;
    --card: #fff;
    --maxw: 1100px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: linear-gradient(180deg,var(--bg),#fff);
    color:#222;
    display:flex;
    justify-content:center;
    padding:28px 14px;
  }
  .app{
    width:100%;
    max-width:var(--maxw);
  }
  header{
    display:flex;
    gap:16px;
    align-items:center;
    background: linear-gradient(90deg,var(--orange),var(--army-green));
    color:white;
    padding:16px;
    border-radius:12px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.08);
  }
  .logo{
    width:64px;
    height:64px;
    border-radius:12px;
    background:var(--brown);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    font-size:18px;
    color:white;
  }
  .title h1{margin:0; font-size:22px;}
  .title p{margin:2px 0 0;font-size:13px;opacity:0.95}
  nav{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap}
  a.navbtn{
    padding:8px 12px;
    border-radius:10px;
    text-decoration:none;
    color:white;
    font-weight:700;
    background:rgba(0,0,0,0.12);
  }
  main{margin-top:18px;}
  .screen{ display:none; }
  .screen.active{ display:block; }

  .card{
    background:var(--card);
    padding:16px;
    border-radius:12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    margin-bottom:14px;
  }

  .gallery{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
    gap:14px;
  }
  .game{
    border-radius:10px;
    overflow:hidden;
    background:linear-gradient(180deg,#fff,#fafafa);
    display:flex;
    flex-direction:column;
    min-height:160px;
    border-left:6px solid var(--orange);
  }
  .thumb{
    height:120px;
    background:linear-gradient(90deg,#eee,#f6f6f6);
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--gray);
    font-weight:700;
  }
  .game .content{ padding:12px; display:flex; flex-direction:column; gap:8px; flex:1 }
  .btn{
    display:inline-block;
    padding:8px 12px;
    border-radius:8px;
    text-decoration:none;
    color:white;
    font-weight:700;
    background:var(--army-green);
    border:none;
    cursor:pointer;
  }
  .btn.secondary{ background:var(--gray); }
  .btn.danger{ background:#c94b4b; }
  .muted{ color:var(--gray); font-size:13px; }

  form .row{ display:flex; gap:12px; }
  input[type=text], input[type=url], textarea, input[type=file], input[type=password]{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #e6e6e6;
    font-size:14px;
  }
  textarea{ min-height:120px; resize:vertical; }

  .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

  .small{ font-size:13px; color:var(--gray); }

  footer{ margin-top:18px; text-align:center; color:var(--gray); font-size:13px; padding-bottom:40px; }
  .kbd{ background:#f2f2f2; padding:4px 8px; border-radius:6px; font-weight:700; font-size:13px; }

  /* admin labels */
  .pill{ display:inline-block; padding:6px 10px; border-radius:999px; background:#f4f4f4; font-size:13px; color:#333; }

  @media (max-width:560px){
    .logo{width:52px;height:52px;font-size:16px}
    header{padding:12px}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">BTS</div>
      <div class="title">
        <h1>Bob the Stickman — Community Games</h1>
        <p>Your community game gallery — submit, review, and play!</p>
        <nav>
          <a href="#" class="navbtn" data-screen="home">Home</a>
          <a href="#" class="navbtn" data-screen="submit">Add a Game</a>
          <a href="#" class="navbtn" data-screen="adminLogin">Admin</a>
        </nav>
      </div>
    </header>

    <main>
      <!-- HOME / GALLERY -->
      <section id="home" class="screen active">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">Approved Games</div>
            <div class="small">Stored locally in this browser</div>
          </div>
          <div style="margin-top:12px" id="approvedCount" class="small"></div>
          <div class="gallery cardless" id="approvedList" style="margin-top:12px"></div>
        </div>

        <div class="card">
          <h3>How to submit</h3>
          <ol>
            <li>Click <strong>Add a Game</strong> and either paste a link to your hosted game (recommended) or upload a single file (HTML build or packed file). For files we store a Data URL so the admin can open/play it.</li>
            <li>The admin will review pending submissions and approve them if they work.</li>
            <li>Approved games appear here in the public gallery.</li>
          </ol>
        </div>
      </section>

      <!-- SUBMIT -->
      <section id="submit" class="screen">
        <div class="card">
          <h2>Submit a Game</h2>
          <p class="small">You can submit a URL or upload a single file. If you upload a file it will be stored in your browser's localStorage (may be large) — prefer hosting your game and submitting a link.</p>

          <form id="submitForm">
            <label>Game Title</label>
            <input type="text" id="s_title" placeholder="My Awesome Game" required>

            <label style="margin-top:10px">Creator Name</label>
            <input type="text" id="s_creator" placeholder="Creator handle">

            <label style="margin-top:10px">Game Link (paste web URL here) — optional if uploading file</label>
            <input type="url" id="s_link" placeholder="https://example.com/mygame">

            <label style="margin-top:10px">Or upload a file (html, zip, etc.) — optional if you provide a link</label>
            <input type="file" id="s_file" accept=".html,.htm,.zip,application/zip,application/x-zip-compressed,application/octet-stream">

            <label style="margin-top:10px">Short message / description</label>
            <textarea id="s_message" placeholder="A short description, controls, instructions..."></textarea>

            <div style="margin-top:12px" class="controls">
              <button class="btn" type="submit">Send Submission</button>
              <button class="btn secondary" type="button" id="clearSubmit">Clear</button>
              <span class="small" id="submitHint">Submissions go to the pending queue for admin review.</span>
            </div>
          </form>
        </div>
      </section>

      <!-- ADMIN LOGIN -->
      <section id="adminLogin" class="screen">
        <div class="card" style="max-width:560px;margin:auto">
          <h2>Admin Login</h2>
          <p class="small">Enter the admin passcode to view pending submissions. (Passcode is <span class="kbd">stego</span>.)</p>

          <form id="loginForm">
            <label>Passcode</label>
            <input type="password" id="adminPass" placeholder="Enter passcode" required>
            <div style="margin-top:12px" class="controls">
              <button class="btn" type="submit">Enter Admin</button>
              <button class="btn secondary" type="button" id="cancelLogin">Cancel</button>
            </div>
            <div id="loginMsg" class="small" style="margin-top:10px;color:#c94b4b;display:none"></div>
          </form>

          <hr style="margin-top:16px;margin-bottom:8px;border:none;border-top:1px dashed #eee">
          <div class="small">
            Note: admin access here uses client-side protection (not secure against someone with devtools). To lock the repository page itself, use server-side auth.
          </div>
        </div>
      </section>

      <!-- ADMIN DASHBOARD -->
      <section id="adminDash" class="screen">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h2 style="margin:0">Admin Dashboard</h2>
            </div>
            <div class="controls">
              <button class="btn" id="logoutBtn">Logout</button>
              <button class="btn secondary" id="exportBtn">Export Data</button>
              <button class="btn secondary" id="importBtn">Import Data</button>
            </div>
          </div>

          <div style="margin-top:12px" class="card">
            <h3 style="margin-top:0">Pending Submissions</h3>
            <div id="pendingList" class="gallery"></div>
            <div id="noPending" class="small" style="margin-top:8px">No pending submissions.</div>
          </div>

          <div style="margin-top:12px" class="card">
            <h3 style="margin-top:0">Approved Games (Admin view)</h3>
            <div id="approvedAdminList" class="gallery"></div>
          </div>

          <div style="margin-top:12px" class="small">
            Approve moves a pending submission into the public gallery. Deny deletes it. Play opens the game (link or uploaded file) in a new tab.
          </div>
        </div>
      </section>
    </main>

    <footer>
      Colors: orange · army green · gray · brown — Site runs entirely in your browser (localStorage).
    </footer>
  </div>

<script>
/* ===========================
   Simple Single-file App
   Data stored in localStorage under keys:
    - bts_pending   : array of submission objects
    - bts_approved  : array of approved game objects
   Submission object schema:
    {
      id: "<timestamp-rand>",
      title: "string",
      creator: "string",
      message: "string",
      link: "https://..." OR null,
      fileDataUrl: "data:..." OR null,
      filename: "original name or null",
      createdAt: 1690000000000
    }
   Approved object similar, keep fileDataUrl if admin approved file-based content.
   =========================== */

(function(){
  const STORAGE_PENDING = 'bts_pending';
  const STORAGE_APPROVED = 'bts_approved';
  const ADMIN_PASS = 'stego'; // the passcode asked for
  const navButtons = document.querySelectorAll('a.navbtn');
  const screens = document.querySelectorAll('.screen');

  // Utilities
  function qs(id){ return document.getElementById(id); }
  function uid(){ return Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8); }
  function readJSON(key, fallback){ try { return JSON.parse(localStorage.getItem(key)) || fallback; } catch(e){ return fallback; } }
  function writeJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
  function safeOpen(url, name='_blank'){ window.open(url, name, 'noopener'); }

  // load initial arrays
  let pending = readJSON(STORAGE_PENDING, []);
  let approved = readJSON(STORAGE_APPROVED, []);

  // Show screen by id
  function showScreen(id){
    screens.forEach(s => s.classList.toggle('active', s.id === id));
    // update some stateful UI
    if(id === 'home') renderApprovedList();
    if(id === 'adminDash') {
      renderPending();
      renderApprovedAdmin();
    }
  }

  navButtons.forEach(btn => btn.addEventListener('click', (e)=>{
    e.preventDefault();
    const target = btn.dataset.screen;
    // if admin link clicked, go to adminLogin instead (unless logged in)
    if(target === 'adminLogin'){
      if(sessionStorage.getItem('bts_admin_logged') === '1'){
        showScreen('adminDash');
      } else {
        showScreen('adminLogin');
      }
      return;
    }
    showScreen(target);
    window.scrollTo({top:0,behavior:'smooth'});
  }));

  /* -----------------------
     Home / Approved gallery
     ----------------------- */
  const approvedListEl = qs('approvedList');
  const approvedCount = qs('approvedCount');

  function renderApprovedList(){
    approvedListEl.innerHTML = '';
    approvedCount.textContent = `Total: ${approved.length}`;
    if(approved.length === 0){
      approvedListEl.innerHTML = `<div class="card small">No approved games yet. Be the first to submit!</div>`;
      return;
    }
    approved.forEach(game => {
      const el = document.createElement('article');
      el.className = 'game card';
      el.innerHTML = `
        <div class="thumb">${escapeHtml(game.title)}</div>
        <div class="content">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div style="font-weight:800">${escapeHtml(game.title)}</div>
              <div class="small">By: ${escapeHtml(game.creator || 'Unknown')}</div>
            </div>
            <div class="small muted">${new Date(game.createdAt).toLocaleString()}</div>
          </div>
          <div style="margin-top:auto;display:flex;gap:8px;align-items:center">
            <button class="btn" data-play="${game.id}">Play</button>
            <a class="btn secondary" href="#" data-info="${game.id}">Info</a>
          </div>
        </div>
      `;
      approvedListEl.appendChild(el);
      // play handler
      el.querySelector('[data-play]').addEventListener('click', ()=> playGame(game));
      el.querySelector('[data-info]').addEventListener('click', (ev)=> {
        ev.preventDefault();
        alert(`${game.title}\nBy: ${game.creator || 'Unknown'}\nSubmitted: ${new Date(game.createdAt).toLocaleString()}\n\nDescription:\n${game.message || '(none)'}\n\nLink: ${game.link || (game.filename ? ('(uploaded file) ' + game.filename) : '(none)')}`);
      });
    });
  }

  /* -----------------------
     Submit form
     ----------------------- */
  const submitForm = qs('submitForm');
  const s_file = qs('s_file');

  submitForm.addEventListener('submit', function(e){
    e.preventDefault();
    const title = qs('s_title').value.trim();
    if(!title){ alert('Please enter a game title.'); return; }
    const creator = qs('s_creator').value.trim();
    const link = qs('s_link').value.trim() || null;
    const message = qs('s_message').value.trim() || '';
    const file = s_file.files && s_file.files[0];

    if(!link && !file){
      if(!confirm('You did not provide a link or upload a file. Do you want to submit anyway?')) return;
    }

    if(file){
      // read file as dataURL
      const reader = new FileReader();
      reader.onload = function(evt){
        const dataUrl = evt.target.result;
        addPending({
          id: uid(),
          title, creator, message,
          link: link,
          fileDataUrl: dataUrl,
          filename: file.name,
          createdAt: Date.now()
        });
        submitForm.reset();
        alert('Submission added to pending queue. Admin will review it in the Admin Dashboard.');
        showScreen('home');
      };
      reader.onerror = function(){
        alert('Failed to read file.');
      };
      reader.readAsDataURL(file);
    } else {
      addPending({
        id: uid(),
        title, creator, message,
        link: link,
        fileDataUrl: null,
        filename: null,
        createdAt: Date.now()
      });
      submitForm.reset();
      alert('Submission added to pending queue. Admin will review it in the Admin Dashboard.');
      showScreen('home');
    }
  });

  qs('clearSubmit').addEventListener('click', ()=>{
    if(confirm('Clear the submission form?')) submitForm.reset();
  });

  function addPending(obj){
    pending.unshift(obj);
    writeJSON(STORAGE_PENDING, pending);
  }

  /* -----------------------
     Admin login
     ----------------------- */
  qs('loginForm').addEventListener('submit', function(e){
    e.preventDefault();
    const pass = qs('adminPass').value;
    if(pass === ADMIN_PASS){
      sessionStorage.setItem('bts_admin_logged', '1');
      qs('adminPass').value = '';
      showScreen('adminDash');
    } else {
      const msg = qs('loginMsg');
      msg.textContent = 'Incorrect passcode.';
      msg.style.display = 'block';
      setTimeout(()=> msg.style.display = 'none', 2500);
    }
  });
  qs('cancelLogin').addEventListener('click', ()=> showScreen('home'));

  qs('logoutBtn').addEventListener('click', ()=>{
    sessionStorage.removeItem('bts_admin_logged');
    showScreen('home');
  });

  /* -----------------------
     Admin dashboard: render pending + approved admin view
     ----------------------- */
  function renderPending(){
    const pendingEl = qs('pendingList');
    pendingEl.innerHTML = '';
    if(pending.length === 0){
      qs('noPending').style.display = 'block';
      return;
    }
    qs('noPending').style.display = 'none';
    pending.forEach(item => {
      const el = document.createElement('article');
      el.className = 'game card';
      el.innerHTML = `
        <div class="thumb">PENDING</div>
        <div class="content">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div style="font-weight:800">${escapeHtml(item.title)}</div>
              <div class="small">By: ${escapeHtml(item.creator || 'Unknown')}</div>
              <div class="small" style="margin-top:6px">${escapeHtml(item.message || '')}</div>
            </div>
            <div class="small muted">${new Date(item.createdAt).toLocaleString()}</div>
          </div>
          <div style="margin-top:auto;display:flex;gap:8px;align-items:center">
            <button class="btn" data-play="${item.id}">Play</button>
            <button class="btn" data-approve="${item.id}">Approve</button>
            <button class="btn danger" data-deny="${item.id}">Deny</button>
            <button class="btn secondary" data-info="${item.id}">Details</button>
          </div>
        </div>
      `;
      pendingEl.appendChild(el);
      // handlers
      el.querySelector('[data-play]').addEventListener('click', ()=> playSubmission(item));
      el.querySelector('[data-approve]').addEventListener('click', ()=> {
        if(confirm('Approve this submission?')) {
          approveSubmission(item.id);
        }
      });
      el.querySelector('[data-deny]').addEventListener('click', ()=> {
        if(confirm('Deny and delete this submission?')) {
          denySubmission(item.id);
        }
      });
      el.querySelector('[data-info]').addEventListener('click', ()=> {
        alert(`Title: ${item.title}\nBy: ${item.creator || 'Unknown'}\nSubmitted: ${new Date(item.createdAt).toLocaleString()}\n\nDescription:\n${item.message || '(none)'}\n\nLink: ${item.link || (item.filename ? ('(uploaded) ' + item.filename) : '(none)')}`);
      });
    });
  }

  function renderApprovedAdmin(){
    const el = qs('approvedAdminList');
    el.innerHTML = '';
    if(approved.length === 0){
      el.innerHTML = `<div class="card small">No approved games.</div>`;
      return;
    }
    approved.forEach(game => {
      const item = document.createElement('article');
      item.className = 'game card';
      item.innerHTML = `
        <div class="thumb">APPROVED</div>
        <div class="content">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div style="font-weight:800">${escapeHtml(game.title)}</div>
              <div class="small">By: ${escapeHtml(game.creator || 'Unknown')}</div>
            </div>
            <div class="small muted">${new Date(game.createdAt).toLocaleString()}</div>
          </div>
          <div style="margin-top:auto;display:flex;gap:8px;align-items:center">
            <button class="btn" data-play="${game.id}">Play</button>
            <button class="btn danger" data-delete="${game.id}">Remove</button>
            <button class="btn secondary" data-info="${game.id}">Info</button>
          </div>
        </div>
      `;
      el.appendChild(item);
      item.querySelector('[data-play]').addEventListener('click', ()=> playGame(game));
      item.querySelector('[data-delete]').addEventListener('click', ()=> {
        if(confirm('Remove this approved game from gallery?')) removeApproved(game.id);
      });
      item.querySelector('[data-info]').addEventListener('click', ()=> {
        alert(`${game.title}\nBy: ${game.creator || 'Unknown'}\nSubmitted: ${new Date(game.createdAt).toLocaleString()}\n\nDescription:\n${game.message || '(none)'}\n\nLink: ${game.link || (game.filename ? ('(uploaded) ' + game.filename) : '(none)')}`);
      });
    });
  }

  /* -----------------------
     Actions: play, approve, deny, remove
     ----------------------- */
  function playSubmission(sub){
    // prefer link if present
    if(sub.link){
      safeOpen(sub.link);
      return;
    }
    if(sub.fileDataUrl){
      playDataUrl(sub.fileDataUrl, sub.filename || sub.title);
      return;
    }
    alert('No playable link or file found for this submission.');
  }

  function playGame(game){
    if(game.link){
      safeOpen(game.link);
      return;
    }
    if(game.fileDataUrl){
      playDataUrl(game.fileDataUrl, game.filename || game.title);
      return;
    }
    alert('No playable link or file found.');
  }

  function playDataUrl(dataUrl, filename){
    // try to infer type
    // open in new tab as blob URL for safer loading
    try {
      // Convert dataURL to blob
      const arr = dataUrl.split(',');
      const mimeMatch = arr[0].match(/data:([^;]+);/);
      const mime = mimeMatch ? mimeMatch[1] : 'application/octet-stream';
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8 = new Uint8Array(n);
      while(n--){
        u8[n] = bstr.charCodeAt(n);
      }
      const blob = new Blob([u8], {type:mime});
      const url = URL.createObjectURL(blob);
      safeOpen(url);
      // release object URL after a while (can't detect when tab closed easily)
      setTimeout(()=> URL.revokeObjectURL(url), 60*1000);
    } catch(e){
      // fallback: open data URL directly
      safeOpen(dataUrl);
    }
  }

  function approveSubmission(id){
    const idx = pending.findIndex(p => p.id === id);
    if(idx === -1) return alert('Submission not found.');
    const item = pending.splice(idx,1)[0];
    approved.unshift(item);
    writeJSON(STORAGE_PENDING, pending);
    writeJSON(STORAGE_APPROVED, approved);
    renderPending();
    renderApprovedAdmin();
    renderApprovedList();
  }

  function denySubmission(id){
    const idx = pending.findIndex(p => p.id === id);
    if(idx === -1) return alert('Submission not found.');
    if(!confirm('Are you sure you want to permanently delete this pending submission?')) return;
    pending.splice(idx,1);
    writeJSON(STORAGE_PENDING, pending);
    renderPending();
  }

  function removeApproved(id){
    const idx = approved.findIndex(p => p.id === id);
    if(idx === -1) return alert('Approved item not found.');
    approved.splice(idx,1);
    writeJSON(STORAGE_APPROVED, approved);
    renderApprovedAdmin();
    renderApprovedList();
  }

  /* -----------------------
     Data export / import
     ----------------------- */
  qs('exportBtn').addEventListener('click', ()=>{
    const payload = {
      pending, approved,
      exportedAt: Date.now()
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'bts-data-export.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=> URL.revokeObjectURL(url), 1000);
  });

  qs('importBtn').addEventListener('click', ()=>{
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json,application/json';
    input.onchange = function(){
      const f = input.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = function(e){
        try {
          const obj = JSON.parse(e.target.result);
          if(Array.isArray(obj.pending) && Array.isArray(obj.approved)){
            if(confirm('Import will REPLACE current pending and approved lists. Continue?')){
              pending = obj.pending;
              approved = obj.approved;
              writeJSON(STORAGE_PENDING, pending);
              writeJSON(STORAGE_APPROVED, approved);
              alert('Import successful.');
              renderPending();
              renderApprovedAdmin();
              renderApprovedList();
            }
          } else {
            alert('Invalid file format.');
          }
        } catch(err){
          alert('Failed to parse file.');
        }
      };
      r.readAsText(f);
    };
    input.click();
  });

  /* -----------------------
     Helpers
     ----------------------- */
  function escapeHtml(s){
    if(!s) return '';
    return s.replace(/[&<>"']/g, function(m){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
    });
  }

  // Initial render
  renderApprovedList();

  // If admin already logged in this session, skip login
  if(sessionStorage.getItem('bts_admin_logged') === '1'){
    // replace Admin nav behaviour to go straight to dashboard
    // handled by nav listener; ensure show adminDash if someone clicked admin earlier
  }

  // On page load, bind navigation anchor to active page detection
  // (already done above). Also handle direct hash navigation optionally
  // Support ?screen=... in URL
  (function handleInitialScreen(){
    const url = new URL(window.location.href);
    const sparam = url.searchParams.get('screen');
    const valid = ['home','submit','adminLogin','adminDash'];
    if(sparam && valid.includes(sparam)){
      if(sparam === 'adminDash' && sessionStorage.getItem('bts_admin_logged') !== '1'){
        showScreen('adminLogin');
      } else {
        showScreen(sparam);
      }
    } else {
      showScreen('home');
    }
  })();

})();
</script>
</body>
</html>
